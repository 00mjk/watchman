<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>watchman | A file watching service</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="watchman | A file watching service"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/watchman/index.html"><meta property="og:image" content="http://facebook.github.io/watchman/favicon.png"><meta property="og:description" content="A file watching service"><link rel="shortcut icon" href="/watchman/img/favicon.png"><link rel="stylesheet" href="/watchman/css/watchman.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/watchman/">watchman</a><ul class="nav-site"><li><a href="/watchman/docs/install.html" class="active">docs</a></li><li><a href="/watchman/support.html" class="">support</a></li><li><a href="http://github.com/facebook/watchman" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Installation</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/install.html">Installation</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/release-notes.html">Release Notes</a></li></ul></div><div class="nav-docs-section"><h3>Invocation</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/cli-options.html">Command Line</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/config.html">Configuration Files</a></li><li><a style="margin-left:0;" class="active" href="/watchman/docs/socket-interface.html">Socket Interface</a></li></ul></div><div class="nav-docs-section"><h3>Compatibility</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/compatibility.html">Compatibility Rules</a></li></ul></div><div class="nav-docs-section"><h3>Commands</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/clock.html">clock</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/find.html">find</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/get-config.html">get-config</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/get-sockname.html">get-sockname</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/log.html">log</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/log-level.html">log-level</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/query.html">query</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/shutdown-server.html">shutdown-server</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/since.html">since</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/subscribe.html">subscribe</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger.html">trigger</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger-del.html">trigger-del</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger-list.html">trigger-list</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/unsubscribe.html">unsubscribe</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/version.html">version</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch.html">watch</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-del.html">watch-del</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-del-all.html">watch-del-all</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-list.html">watch-list</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-project.html">watch-project</a></li></ul></div><div class="nav-docs-section"><h3>Queries</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/clockspec.html">Clockspec</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/file-query.html">File Queries</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/simple-query.html">Simple Pattern Syntax</a></li></ul></div><div class="nav-docs-section"><h3>Internals</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/bser.html">BSER Binary Protocol</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/casefolding.html">Case-Insensitivity</a></li><li><a style="margin-left:0;" class="" href="/watchman/contributing.html">Contributing</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cookies.html">Query Synchronization</a></li></ul></div><div class="nav-docs-section"><h3>Troubleshooting</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/troubleshooting.html">Troubleshooting</a></li></ul></div></div><div class="inner-content"><h1>Socket Interface</h1><div><p>Most simple uses of Watchman will invoke the watchman binary and process its
output.  Sometimes it is desirable to avoid the overhead of an extra process
and talk directly to your watchman service.</p><p>The watchman service runs as a single long-lived process per user.  The
watchman binary will take care of spawning the server process if necessary.</p><p>The server will create a unix domain socket for communication with its clients.
The location of the socket depends on compile time options and command line
flags.  It is recommended that you invoke <code>watchman get-sockname</code> to discover
the location, or if you are being invoked via a trigger (since version 2.9.7)
you will find the location in the <code>$WATCHMAN_SOCK</code> environmental variable.</p><h2><a class="anchor" name="watchman-protocol"></a>Watchman Protocol <a class="hash-link" href="#watchman-protocol">#</a></h2><p>The unix socket implements a request-response protocol with PDUs encoded in
either JSON or BSER representation.  Some watchman commands (notably
<code>subscribe</code> and <code>log-level</code>) allow the watchman service to unilaterally send
any number of PDUs to the client, and require more stateful handling.</p><h3><a class="anchor" name="json-encoding"></a>JSON encoding <a class="hash-link" href="#json-encoding">#</a></h3><p>The JSON encoding represents a request or a response as a single line of
compact JSON encoded data.  The newline is used to detect the end of the PDU.</p><p>Requests from the client are always represented as a JSON array.</p><p>Responses from the server are always represented as a JSON object.</p><p>Sending the <code>since</code> command is simply a matter of formatting it as JSON.  Note
that the JSON text must be a single line (don&#x27;t send a pretty printed version
of it!) and be followed by a newline <code>\n</code> character:</p><div class="prism language-javascript"><span class="token punctuation">[</span><span class="token string">&quot;since&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/src&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;n:c_srcs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.c&quot;</span><span class="token punctuation">]</span> &lt;NEWLINE<span class="token operator">&gt;</span></div><h3><a class="anchor" name="bser-encoding"></a>BSER encoding <a class="hash-link" href="#bser-encoding">#</a></h3><p>BSER is a local-only binary serialization format that can represent the same
data types as JSON, but in a more compact form and not be limited to UTF-8
representation of strings.</p><p>When you make a request using BSER, the server will respond in BSER encoding.</p><p>You can <a href="/watchman/docs/bser.html" target="">read more about BSER in the BSER specification</a>.</p><h3><a class="anchor" name="reporting-errors-and-warnings"></a>Reporting Errors and Warnings <a class="hash-link" href="#reporting-errors-and-warnings">#</a></h3><p>If a Response includes a field named <code>error</code> it indicates that the request was
not successful.  The <code>error</code> field, if present, is a string value that can be
presented to the user.</p><p>If a Response includes a field named <code>warning</code> it indicates that there is some
condition that should be reported back to the user so that the system can
operate more effectively.  Tools should display this to the user as an
advisory.  At the time of writing, this can be triggered due to overflowing the
system limits on file watching resources.  These are important to address so
that events are not missed and thus so that correctness and system performance
are maintained.</p><p>The warning message contains a link to this documentation that provides
advice on tuning and resolving the issue.</p></div><div class="docs-prevnext"></div></div></section><footer class="wrap"><div class="right">Â© 2012-2015 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script></body></html>