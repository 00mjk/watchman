<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>watchman | A file watching service</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="watchman | A file watching service"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/watchman/index.html"><meta property="og:image" content="http://facebook.github.io/watchman/img/favicon.png"><meta property="og:description" content="A file watching service"><link rel="shortcut icon" href="/watchman/img/favicon.png"><link rel="stylesheet" href="/watchman/css/watchman.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/watchman/">watchman</a><ul class="nav-site"><li><a href="/watchman/docs/install.html" class="active">docs</a></li><li><a href="/watchman/support.html" class="">support</a></li><li><a href="http://github.com/facebook/watchman" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Installation</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/install.html">Installation</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/release-notes.html">Release Notes</a></li></ul></div><div class="nav-docs-section"><h3>Invocation</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/cli-options.html">Command Line</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/config.html">Configuration Files</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/socket-interface.html">Socket Interface</a></li></ul></div><div class="nav-docs-section"><h3>Compatibility</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/compatibility.html">Compatibility Rules</a></li></ul></div><div class="nav-docs-section"><h3>Commands</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/clock.html">clock</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/find.html">find</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/get-config.html">get-config</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/get-sockname.html">get-sockname</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/log.html">log</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/log-level.html">log-level</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/query.html">query</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/shutdown-server.html">shutdown-server</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/since.html">since</a></li><li><a style="margin-left:0;" class="active" href="/watchman/docs/cmd/subscribe.html">subscribe</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger.html">trigger</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger-del.html">trigger-del</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger-list.html">trigger-list</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/unsubscribe.html">unsubscribe</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/version.html">version</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch.html">watch</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-del.html">watch-del</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-del-all.html">watch-del-all</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-list.html">watch-list</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-project.html">watch-project</a></li></ul></div><div class="nav-docs-section"><h3>Queries</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/clockspec.html">Clockspec</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/file-query.html">File Queries</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/simple-query.html">Simple Pattern Syntax</a></li></ul></div><div class="nav-docs-section"><h3>Expression Terms</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/allof.html">allof</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/anyof.html">anyof</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/dirname.html">dirname &amp; idirname</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/empty.html">empty</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/exists.html">exists</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/false.html"></a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/match.html">match &amp; imatch</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/name.html">name &amp; iname</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/not.html">not</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/pcre.html">pcre &amp; ipcre</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/since.html">since</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/size.html">size</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/suffix.html">suffix</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/true.html"></a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/type.html">type</a></li></ul></div><div class="nav-docs-section"><h3>Internals</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/bser.html">BSER Binary Protocol</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/casefolding.html">Case-Insensitivity</a></li><li><a style="margin-left:0;" class="" href="/watchman/contributing.html">Contributing</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cookies.html">Query Synchronization</a></li></ul></div><div class="nav-docs-section"><h3>Troubleshooting</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/troubleshooting.html">Troubleshooting</a></li></ul></div></div><div class="inner-content"><h1>subscribe</h1><div><p>Available starting in version 1.6</p><p>Subscribes to changes against a specified root and requests that they be sent
to the client via its connection.  The updates will continue to be sent while
the connection is open.  If the connection is closed, the subscription is
implicitly removed.</p><p>This makes the most sense in an application connecting via the socket
interface, but you may also subscribe via the command line tool if you&#x27;re
interested in observing the changes for yourself:</p><div class="prism language-javascript">$ watchman <span class="token operator">-</span>j <span class="token operator">--</span>server<span class="token operator">-</span>encoding<span class="token operator">=</span>json <span class="token operator">-</span>p &lt;&lt;<span class="token operator">-</span>EOT
<span class="token punctuation">[</span><span class="token string">&quot;subscribe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mysubscriptionname&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;expression&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;allof&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;f&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;not&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;empty&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;suffix&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;php&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;fields&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
EOT</div><p>The example above registers a subscription against the specified root with the
name <code>mysubscriptionname</code>.</p><p>The response to a subscribe command looks like this:</p><div class="prism language-javascript"><span class="token punctuation">{</span>
  <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span>   <span class="token string">&quot;1.6&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;subscribe&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;mysubscriptionname&quot;</span>
<span class="token punctuation">}</span></div><p>When the subscription is first established, the
expression term is evaluated and if any files match, a subscription notification
packet is generated and sent, unilaterally to the client.</p><p>Then, each time a change is observed, and after the settle period has passed,
the expression is evaluated again.  If any files are matched, the server will
unilaterally send the query results to the client with a packet that looks like
this:</p><div class="prism language-javascript"><span class="token punctuation">{</span>
  <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1.6&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;clock&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;c:1234:123&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;files&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;one.php&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;root&quot;</span><span class="token punctuation">:</span>  <span class="token string">&quot;/path/being/watched&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;subscription&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;mysubscriptionname&quot;</span>
<span class="token punctuation">}</span></div><p>The subscribe command object allows the client to specify a since parameter; if
present in the command, the initial set of subscription results will only
include files that changed since the specified clockspec, equivalent to using
the <code>query</code> command with the <code>since</code> generator.</p><div class="prism language-javascript"><span class="token punctuation">[</span><span class="token string">&quot;subscribe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;myname&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;since&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;c:1234:123&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;expression&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;not&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;empty&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;fields&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span></div><p>The suggested mode of operation is for the client process to maintain its own
local copy of the last &quot;clock&quot; value and use that to establish the subscription
when it first connects.</p><h2><a class="anchor" name="filesystem-settling"></a>Filesystem Settling <a class="hash-link" href="#filesystem-settling">#</a></h2><p>Prior to watchman version 3.2, the settling behavior was to hold subscription
notifications until the kernel notification stream was complete.</p><p>Starting in watchman version 3.2, after the notification stream is complete, if
the root appears to be a version control directory, subscription notifications
will be held until an outstanding version control operation is complete (at the
time of writing, this is based on the presence of either <code>.hg/wlock</code> or
<code>.git/index.lock</code>).  This behavior matches triggers and helps to avoid
performing transient work in response to files changing, for example, during a
rebase operation.</p><p>In some circumstances it is desirable for a client to observe the creation of
the control files at the start of a version control operation.  You may specify
that you want this behavior by passing the <code>defer_vcs</code> flag to your subscription
command invocation:</p><div class="prism language-javascript">$ watchman <span class="token operator">-</span>j <span class="token operator">-</span>p &lt;&lt;<span class="token operator">-</span>EOT
<span class="token punctuation">[</span><span class="token string">&quot;subscribe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mysubscriptionname&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;expression&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;allof&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;f&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;not&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;empty&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;suffix&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;php&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;defer_vcs&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token string">&quot;fields&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
EOT</div></div><div class="docs-prevnext"></div></div></section><footer class="wrap"><div class="right">© 2012-2015 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script></body></html>