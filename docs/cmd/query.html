<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>watchman | A file watching service</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="watchman | A file watching service"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/watchman/index.html"><meta property="og:image" content="http://facebook.github.io/watchman/favicon.png"><meta property="og:description" content="A file watching service"><link rel="shortcut icon" href="/watchman/img/favicon.png"><link rel="stylesheet" href="/watchman/css/watchman.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/watchman/">watchman</a><ul class="nav-site"><li><a href="/watchman/docs/install.html" class="active">docs</a></li><li><a href="/watchman/support.html" class="">support</a></li><li><a href="http://github.com/facebook/watchman" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Installation</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/install.html">Installation</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/release-notes.html">Release Notes</a></li></ul></div><div class="nav-docs-section"><h3>Invocation</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/cli-options.html">Command Line</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/config.html">Configuration Files</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/socket-interface.html">Socket Interface</a></li></ul></div><div class="nav-docs-section"><h3>Compatibility</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/compatibility.html">Compatibility Rules</a></li></ul></div><div class="nav-docs-section"><h3>Commands</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/clock.html">clock</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/find.html">find</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/get-config.html">get-config</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/get-sockname.html">get-sockname</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/log.html">log</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/log-level.html">log-level</a></li><li><a style="margin-left:0;" class="active" href="/watchman/docs/cmd/query.html">query</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/shutdown-server.html">shutdown-server</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/since.html">since</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/subscribe.html">subscribe</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger.html">trigger</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger-del.html">trigger-del</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger-list.html">trigger-list</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/unsubscribe.html">unsubscribe</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/version.html">version</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch.html">watch</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-del.html">watch-del</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-del-all.html">watch-del-all</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-list.html">watch-list</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-project.html">watch-project</a></li></ul></div><div class="nav-docs-section"><h3>Queries</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/clockspec.html">Clockspec</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/file-query.html">File Queries</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/simple-query.html">Simple Pattern Syntax</a></li></ul></div><div class="nav-docs-section"><h3>Internals</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/bser.html">BSER Binary Protocol</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/casefolding.html">Case-Insensitivity</a></li><li><a style="margin-left:0;" class="" href="/watchman/contributing.html">Contributing</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cookies.html">Query Synchronization</a></li></ul></div><div class="nav-docs-section"><h3>Troubleshooting</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/troubleshooting.html">Troubleshooting</a></li></ul></div></div><div class="inner-content"><h1>query</h1><div><p>Available starting in version 1.6</p><div class="prism language-javascript">$ watchman <span class="token operator">-</span>j &lt;&lt;<span class="token operator">-</span>EOT
<span class="token punctuation">[</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/root&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;suffix&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;php&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;expression&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;allof&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;f&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;not&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;empty&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;ipcre&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;basename&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;fields&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
EOT</div><p>Executes a query against the specified root. This example uses the <code>-j</code> flag to
the watchman binary that tells it to read stdin and interpret it as the JSON
request object to send to the watchman service.  This flag allows you to send
in a pretty JSON object (as shown above), but if you&#x27;re using the socket
interface you must still format the object as a single line JSON request as
documented in the protocol spec.</p><p>The first argument to query is the path to the watched root.  The second
argument holds a JSON object describing the query to be run.  The query object
is processed by passing it to the query engine (see <a href="/watchman/docs/file-query.html" target="">File Queries</a>) which will generate a set of matching files.</p><p>The query command will then consult the <code>fields</code> member of the query object;
if it is not present it will default to:</p><div class="prism language-javascript"><span class="token string">&quot;fields&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exists&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;new&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;size&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mode&quot;</span><span class="token punctuation">]</span></div><p>For each file in the result set, the query command will generate a JSON object
value populated with the requested fields.  For example, the default set of
fields will return a response something like this:</p><div class="prism language-javascript"><span class="token punctuation">{</span>
    <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2.9&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;clock&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;c:80616:59&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;is_fresh_instance&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">&quot;files&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">&quot;exists&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string">&quot;mode&quot;</span><span class="token punctuation">:</span> <span class="token number">33188</span><span class="token punctuation">,</span>
            <span class="token string">&quot;new&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;argv.c&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> <span class="token number">1340</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span></div><p>For queries using the <code>since</code> generator, the <code>is_fresh_instance</code> member is true
if the particular clock value indicates that it was returned by a different
instance of watchman, or a named cursor hasn&#x27;t been seen before. In that case,
only files that currently exist will be returned, and all files will have <code>new</code>
set to <code>true</code>. For all other queries, is_fresh_instance will always be true.
Advanced users may set the input parameter <code>empty_on_fresh_instance</code> to true,
in which case no files will be returned for fresh instances.</p><p>If the <code>fields</code> member consists of a single entry, the files result will be a
simple array of values; <code>&quot;fields&quot;: [&quot;name&quot;]</code> produces:</p><div class="prism language-javascript"><span class="token punctuation">{</span>
    <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1.5&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;clock&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;c:80616:59&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;files&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;argv.c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo.c&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></div><h><a class="anchor" name="available-fields"></a>Available fields <a class="hash-link" href="#available-fields">#</a></h><ul><li><code>name</code> - string: the filename, relative to the watched root</li><li><code>exists</code> - bool: true if the file exists, false if it has been deleted</li><li><code>cclock</code> - string: the &quot;created clock&quot;; the clock value when we first
observed the file, or the clock value when it last switched from
!exists to exists.</li><li><code>oclock</code> - string: the &quot;observed clock&quot;; the clock value where we last
observed some change in this file or its metadata.</li><li><code>ctime</code>, <code>ctime_ms</code>, <code>ctime_us</code>, <code>ctime_ns</code>, <code>ctime_f</code> -
last inode change time measured in integer seconds, milliseconds,
microseconds, nanoseconds or floating point seconds respectively.</li><li><code>mtime</code>, <code>mtime_ms</code>, <code>mtime_us</code>, <code>mtime_ns</code>, <code>mtime_f</code> -
modified time measured in integer seconds, milliseconds,
microseconds, nanoseconds or floating point seconds respectively.</li><li><code>size</code> - integer: file size in bytes</li><li><code>mode</code> - integer: file (or directory) mode expressed as a decimal integer</li><li><code>uid</code> - integer: the owning uid</li><li><code>gid</code> - integer: the owning gid</li><li><code>ino</code> - integer: the inode number</li><li><code>dev</code> - integer: the device number</li><li><code>nlink</code> - integer: number of hard links</li><li><code>new</code> - bool: whether this entry is newer than the <code>since</code> generator criteria</li><li><code>type</code> - string: the file type. (Available since version 3.1).  Has the
the values listed in <a href="../file-query.html#type" target="_blank">the type query expression</a></li></ul><h><a class="anchor" name="synchronization-timeout-since-2-1"></a>Synchronization timeout (since 2.1) <a class="hash-link" href="#synchronization-timeout-since-2-1">#</a></h><p>By default a <code>query</code> will wait for up to 2 seconds for the view of the
filesystem to become current.  Watchman decides that the view is current by
creating a cookie file and waiting to observe the notification that it is
present.  If the cookie is not observed within the sync_timeout period then the
query invocation will error out with a synchronization error message.</p><p>If your synchronization requirements differ from the default, you may pass in
your desired timeout when you construct your query; it must be an integer value
expressed in milliseconds:</p><div class="prism language-javascript"><span class="token punctuation">[</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/root&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;expression&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;exists&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;fields&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;sync_timeout&quot;</span><span class="token punctuation">:</span> <span class="token number">2000</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span></div><p>You may specify <code>0</code> as the value if you do not wish for the query to create
a cookie and synchronize; the query will be evaluated over the present view
of the tree, which may lag behind the present state of the filesystem.</p></div><div class="docs-prevnext"></div></div></section><footer class="wrap"><div class="right">© 2012-2015 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script></body></html>