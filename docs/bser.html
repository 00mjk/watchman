<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>watchman | A file watching service</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="watchman | A file watching service"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/watchman/index.html"><meta property="og:image" content="http://facebook.github.io/watchman/img/favicon.png"><meta property="og:description" content="A file watching service"><link rel="shortcut icon" href="/watchman/img/favicon.png"><link rel="stylesheet" href="/watchman/css/watchman.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/watchman/">watchman</a><ul class="nav-site"><li><a href="/watchman/docs/install.html" class="active">docs</a></li><li><a href="/watchman/support.html" class="">support</a></li><li><a href="http://github.com/facebook/watchman" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Installation</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/install.html">Installation</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/release-notes.html">Release Notes</a></li></ul></div><div class="nav-docs-section"><h3>Invocation</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/cli-options.html">Command Line</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/config.html">Configuration Files</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/socket-interface.html">Socket Interface</a></li></ul></div><div class="nav-docs-section"><h3>Compatibility</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/compatibility.html">Compatibility Rules</a></li></ul></div><div class="nav-docs-section"><h3>Commands</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/clock.html">clock</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/find.html">find</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/get-config.html">get-config</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/get-sockname.html">get-sockname</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/log.html">log</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/log-level.html">log-level</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/query.html">query</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/shutdown-server.html">shutdown-server</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/since.html">since</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/subscribe.html">subscribe</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger.html">trigger</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger-del.html">trigger-del</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger-list.html">trigger-list</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/unsubscribe.html">unsubscribe</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/version.html">version</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch.html">watch</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-del.html">watch-del</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-del-all.html">watch-del-all</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-list.html">watch-list</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-project.html">watch-project</a></li></ul></div><div class="nav-docs-section"><h3>Queries</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/clockspec.html">Clockspec</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/file-query.html">File Queries</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/simple-query.html">Simple Pattern Syntax</a></li></ul></div><div class="nav-docs-section"><h3>Expression Terms</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/allof.html">allof</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/anyof.html">anyof</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/dirname.html">dirname &amp; idirname</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/empty.html">empty</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/exists.html">exists</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/false.html"></a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/match.html">match &amp; imatch</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/name.html">name &amp; iname</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/not.html">not</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/pcre.html">pcre &amp; ipcre</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/since.html">since</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/size.html">size</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/suffix.html">suffix</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/true.html"></a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/type.html">type</a></li></ul></div><div class="nav-docs-section"><h3>Internals</h3><ul><li><a style="margin-left:0;" class="active" href="/watchman/docs/bser.html">BSER Binary Protocol</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/casefolding.html">Case-Insensitivity</a></li><li><a style="margin-left:0;" class="" href="/watchman/contributing.html">Contributing</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cookies.html">Query Synchronization</a></li></ul></div><div class="nav-docs-section"><h3>Troubleshooting</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/troubleshooting.html">Troubleshooting</a></li></ul></div></div><div class="inner-content"><h1>BSER Binary Protocol</h1><div><p>The basic JSON protocol in watchman allows quick and easy integration.
Applications with higher performance requirements may want to consider the
binary protocol instead.</p><p>The binary protocol is enabled by the client sending the byte sequence
&quot;\x00x\x01&quot;.</p><h2><a class="anchor" name="pdu"></a>PDU <a class="hash-link" href="#pdu">#</a></h2><p>A PDU is prefixed by its length expressed as an encoded integer.  This allows
the peer to determine how much storage is required to read and decode it.</p><h2><a class="anchor" name="arrays"></a>Arrays <a class="hash-link" href="#arrays">#</a></h2><p>Arrays are indicated by a <code>0x00</code> byte value followed by an integer value to
indicate how many items follow.  Then each item is encoded one after the other.</p><h2><a class="anchor" name="objects"></a>Objects <a class="hash-link" href="#objects">#</a></h2><p>Objects are indicated by a <code>0x01</code> byte value followed by an integer value to
indicate the number of properties in the object.  Then each key/value pair is
encoded one after the other.</p><h2><a class="anchor" name="strings"></a>Strings <a class="hash-link" href="#strings">#</a></h2><p>Strings are indicated by a <code>0x02</code> byte value followed by an integer value to
indicate the number of bytes in the string, followed by the bytes of the
string.</p><p>Unlike JSON, strings are not defined as having any particular encoding; they
are transmitted as binary strings.  This is because the underlying filesystem
APIs don&#x27;t define any particular encoding for names.</p><p>Keys in objects that are defined by watchman commands are always ASCII.</p><h2><a class="anchor" name="integers"></a>Integers <a class="hash-link" href="#integers">#</a></h2><p>All integers are signed and transmitted in the host byte order of the system
running the watchman daemon.</p><ul><li><code>0x03</code> indicates an int8_t.  It is followed by the int8_t value.</li><li><code>0x04</code> indicates an int16_t. It is followed by the int16_t value.</li><li><code>0x05</code> indicates an int32_t. It is followed by the int32_t value.</li><li><code>0x06</code> indicates an int64_t. It is followed by the int64_t value.</li></ul><h2><a class="anchor" name="real"></a>Real <a class="hash-link" href="#real">#</a></h2><p>A real number is indicated by a <code>0x07</code> byte followed by 8 bytes of double value.</p><h2><a class="anchor" name="boolean"></a>Boolean <a class="hash-link" href="#boolean">#</a></h2><ul><li><code>0x08</code> indicates boolean true</li><li><code>0x09</code> indicates boolean false</li></ul><h2><a class="anchor" name="null"></a>Null <a class="hash-link" href="#null">#</a></h2><p><code>0x0a</code> indicates the null value</p><h2><a class="anchor" name="array-of-templated-objects"></a>Array of Templated Objects <a class="hash-link" href="#array-of-templated-objects">#</a></h2><p><code>0x0b</code> indicates a compact array of objects follows.  Some of the bigger
datastructures returned by watchman are tabular data expressed as an array
of objects.  This serialization type factors out the repeated object keys
into a header array listing the keys, followed by an array containing
all the values of the objects.</p><p>To represent missing keys in templated arrays, the <code>0x0c</code> encoding value may
be present.  If encountered it is interpreted as meaning that there is no value
for the key that would have been decoded in this position.  This is distinct
from the null value.</p><p>For example:</p><div class="prism language-javascript"><span class="token punctuation">[</span>
   <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;fred&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;pete&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></div><p>is represented similar to:</p><div class="prism language-javascript"><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>
  <span class="token string">&quot;fred&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span>
  <span class="token string">&quot;pete&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>
  <span class="token number">0x0c</span><span class="token punctuation">,</span>   <span class="token number">25</span>
<span class="token punctuation">]</span></div><p>The precise sequence is:</p><div class="prism language-javascript">0b          template
<span class="token number">00</span>          array     <span class="token operator">--</span> start prop names
<span class="token number">0302</span>        int<span class="token punctuation">,</span> <span class="token number">2</span>    <span class="token operator">--</span> two prop names
<span class="token number">02</span>          string    <span class="token operator">--</span> first prop <span class="token string">&quot;name&quot;</span>
<span class="token number">0304</span>        int<span class="token punctuation">,</span> <span class="token number">4</span>
6e616d65    <span class="token string">&quot;name&quot;</span>
<span class="token number">02</span>          string    <span class="token operator">--</span> 2nd prop <span class="token string">&quot;age&quot;</span>
<span class="token number">0303</span>        int<span class="token punctuation">,</span> <span class="token number">3</span>
<span class="token number">616765</span>      <span class="token string">&quot;age&quot;</span>
<span class="token number">0303</span>        int<span class="token punctuation">,</span> <span class="token number">3</span>    <span class="token operator">--</span> there are <span class="token number">3</span> objects
<span class="token number">02</span>          string    <span class="token operator">--</span> object <span class="token number">1</span><span class="token punctuation">,</span> prop <span class="token number">1</span> name<span class="token operator">=</span>fred
<span class="token number">0304</span>        int<span class="token punctuation">,</span> <span class="token number">4</span>
<span class="token number">66726564</span>    <span class="token string">&quot;fred&quot;</span>
<span class="token number">0314</span>        int <span class="token number">0x14</span>  <span class="token operator">--</span> object <span class="token number">1</span><span class="token punctuation">,</span> prop <span class="token number">2</span> age<span class="token operator">=</span><span class="token number">20</span>
<span class="token number">02</span>          string    <span class="token operator">--</span> object <span class="token number">2</span><span class="token punctuation">,</span> prop <span class="token number">1</span> name<span class="token operator">=</span>pete
<span class="token number">0304</span>        int <span class="token number">4</span>
<span class="token number">70657465</span>    <span class="token string">&quot;pete&quot;</span>
031e        int<span class="token punctuation">,</span> <span class="token number">0x1e</span> <span class="token operator">--</span> object <span class="token number">2</span><span class="token punctuation">,</span> prop <span class="token number">2</span> age<span class="token operator">=</span><span class="token number">30</span>
0c          skip      <span class="token operator">--</span> object <span class="token number">3</span><span class="token punctuation">,</span> prop <span class="token number">1</span><span class="token punctuation">,</span> not <span class="token keyword">set</span>
<span class="token number">0319</span>        int<span class="token punctuation">,</span> <span class="token number">0x19</span> <span class="token operator">--</span> object <span class="token number">3</span><span class="token punctuation">,</span> prop <span class="token number">2</span> age<span class="token operator">=</span><span class="token number">25</span></div></div><div class="docs-prevnext"></div></div></section><footer class="wrap"><div class="right">© 2012-2015 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script></body></html>