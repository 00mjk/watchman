(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{151:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return p}));var i=n(1),r=n(6),a=(n(0),n(171)),c={id:"watchman-replicate-subscription",title:"watchman-replicate-subscription"},o={id:"watchman-replicate-subscription",title:"watchman-replicate-subscription",description:"*Since 5.0*",source:"@site/docs/watchman-replicate-subscription.md",permalink:"/docs/watchman-replicate-subscription",editUrl:"https://github.com/facebook/watchman/edit/master/website/docs/watchman-replicate-subscription.md",sidebar:"sidebar",previous:{title:"watchman-wait",permalink:"/docs/watchman-wait"},next:{title:"C++ Client",permalink:"/docs/cppclient"}},l=[{value:"Source subscription",id:"source-subscription",children:[]},{value:"Controlling lifetime",id:"controlling-lifetime",children:[]},{value:"Controlling output",id:"controlling-output",children:[]},{value:"Exit Status",id:"exit-status",children:[]}],s={rightToc:l};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(i.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"Since 5.0")),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"watchman-replicate-subscription")," can replicate an existing watchman\nsubscription. It queries watchman for a list of subscriptions, identifies\nthe source subscription (the subscription to replicate) and subscribes\nto watchman using the same query."),Object(a.b)("p",null,"Integrators can use this client to validate the watchman notifications their\nclient is receiving to localize anomalous behavior."),Object(a.b)("p",null,"The source subscription is identified using any combination of the 'name',\n'pid', and 'client' arguments. The provided combination must uniquely identify\na subscription. Source subscription details for a watched root can be\nretrieved by running the command 'watchman-replicate-subscription --list PATH'."),Object(a.b)("p",null,"By default, the replicated subscription will take the source subscription\nname and prepend the substring 'replicate: ' to it. The 'qname' option can be\nused to specify the replicated subscription name."),Object(a.b)("p",null,"The subscription can stop after a configurable number of events are observed.\nThe default is a single event. You may also remove the limit and allow it to\nexecute continuously."),Object(a.b)("p",null,"watchman-replicate-subscription will print one event per line. The event\ninformation is determined by the fields in the identified subscription, with\neach field separated by a space (or your choice of --separator)."),Object(a.b)("p",null,"Subscription state-enter and state-leave PDUs will be interleaved with other\nevents. Known subscription PDUs (currently only those generated by the\nmercurial fsmonitor extension) will be enclosed in square brackets. All others will be\noutput in JSON format."),Object(a.b)("p",null,"Events are consolidated and settled by the watchman server before they are\ndispatched to watchman-replicate-subscription."),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"watchman-replicate-subscription")," requires pywatchman (and thus requires\npython) as well as watchman."),Object(a.b)("h3",{id:"source-subscription"},"Source subscription"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),"$ watchman-replicate-subscription PATH -n NAME\n")),Object(a.b)("p",null,"The source subscription must be an existing subscription for the provided path.\nAny combination of the 'name', 'pid', and 'client' arguments can be used provided\nthey uniquely identify a subscription. Source subscription details for a watched\nroot can be retrieved as follows:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),"$ watchman-replicate-subscriptions PATH --list\n")),Object(a.b)("p",null,"The subscription name, pid and client can then used to replicate the subscription."),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),"$ watchman-replicate-subscription PATH -n NAME -c CLIENT -p PID\n")),Object(a.b)("h3",{id:"controlling-lifetime"},"Controlling lifetime"),Object(a.b)("p",null,"There are two primary controls for how long ",Object(a.b)("inlineCode",{parentName:"p"},"watchman-replicate-subscription"),"\nwill run:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"-t")," or ",Object(a.b)("inlineCode",{parentName:"li"},"--timeout")," places a time limit on execution"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"-m")," or ",Object(a.b)("inlineCode",{parentName:"li"},"--max-events")," places a limit on the number of events to process")),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"watchman-replicate-subscription")," will terminate when either the timeout is\nhit or the max events limit is hit."),Object(a.b)("p",null,"By default there is no time limit, but there is a default limit of a single event."),Object(a.b)("p",null,"You may specify ",Object(a.b)("inlineCode",{parentName:"p"},"--max-events 0")," to disable the event limit."),Object(a.b)("h3",{id:"controlling-output"},"Controlling output"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"watchman-replicate-subscription")," will output one line per event.  The\nfollowing options influence the output:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"--separator STRING")," - if you specified multiple fields, the separator string\nwill be used when printing them.  The default is ",Object(a.b)("inlineCode",{parentName:"li"},'--separator " "')," which will\nprint the fields with spaces between them.")),Object(a.b)("h3",{id:"exit-status"},"Exit Status"),Object(a.b)("p",null,"The following exit status codes can be used to determine what caused\n",Object(a.b)("inlineCode",{parentName:"p"},"watchman-replicate-subscription")," to exit:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"0")," is returned after successfully waiting for event(s) or listing matching\nsubscriptions"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"1")," in case of a runtime error of some kind"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"2")," the ",Object(a.b)("inlineCode",{parentName:"li"},"-t"),"/",Object(a.b)("inlineCode",{parentName:"li"},"--timeout")," option was used and that amount of time passed\nbefore an event was received"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"3")," if execution was interrupted (Ctrl-C)")))}p.isMDXComponent=!0},171:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var i=n(0),r=n.n(i);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),p=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o({},t,{},e)),n},u=function(e){var t=p(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=Object(i.forwardRef)((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=i,d=u["".concat(c,".").concat(m)]||u[m]||b[m]||a;return n?r.a.createElement(d,o({ref:t},s,{components:n})):r.a.createElement(d,o({ref:t},s))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,c=new Array(a);c[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:i,c[1]=o;for(var s=2;s<a;s++)c[s]=n[s];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);